<gigut-header></gigut-header>

<div class="title-block" style="gap: 8px;">
    @if (!this.renaming) {
        <span class="title">{{issue?.title}}</span>
        <span class="id">#{{issue?.id}}</span>
        <div class="space"></div>
        <button class="edit-button" (click)="renaming = true">
            <span>Edit</span>
        </button>
        <button class="new-issue-button" (click)="this.router.navigate(['/new'])">
            <span>New issue</span>
        </button>
        <button class="trans">
            <svg>
                <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
                <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
            </svg>
        </button>
    } @else {
        <input class="rename-field" [(ngModel)]="newName" (input)="triedToSaveWithoutName = false">
        <button class="cancel-button" (click)="cancelEditing()">
            <span>Cancel</span>
        </button>
        <button class="save-button" (click)="rename()">
            <span>Save</span>
        </button>
    }
   
</div>
<span *ngIf="triedToSaveWithoutName" style="color: #f85149; padding: 0 1.5rem; justify-content: start;">Title can not be empty</span>


<div class="status">
    <div class="status-div svg-open" *ngIf="this.isOpen()">
        <svg style="margin-right: 0.25rem; fill: #fff;">
            <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path>
            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"></path>
        </svg> 
        <span>Open</span>   
    </div>
    <div class="status-div svg-closed" *ngIf="this.isClosed()">
        <svg style="margin-right: 0.25rem; fill: #fff;">
            <path d="M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"></path>
            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"></path>
        </svg>    
        <span>Closed</span>
    </div>
    <div class="status-div svg-not-planned" *ngIf="this.isNotPlanned()">
        <svg style="margin-right: 0.25rem; fill: #fff;">
            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm9.78-2.22-5.5 5.5a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l5.5-5.5a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"></path>
        </svg>
        <span>Closed as not planned</span>
    </div>
</div>


<div class="main-module">

    <div class="left-block">

        <div style="display: flex;">
            <img class="pfp" src="{{issue!.owner.pfp}}" style="margin-right: 1rem;">
            <div class="comment-body">
                <div class="comment-header" style="gap: 3px;">
                    <span style="font-weight: 500;">{{issue!.owner.username}}</span>
                    <span style="color: #9198a1; font-weight: 400;"> opened </span>
                    <!-- <relative-time datetime="{{getDatetime()}}">{{getDatetime()}}</relative-time> -->
                </div>
                @if (issue?.description == "") {
                    <p class="comment-content-body" style="font-style: italic; color: #9198a1;">
                        No description provided
                    </p>
                } @else {
                    <p class="comment-content-body">
                        {{issue?.description}}
                    </p>
                }
            </div>
        </div>

        <history-item *ngFor="let h of issue?.history" [item]="h"/>

        @if (account != undefined) {
            <div class="comment-creator">
                <div style="display: flex;">
                    <img class="pfp" src="{{account.pfp}}">
                    <span class="add-a-coment-label">Add a comment</span>
                </div>
                <textarea [(ngModel)]="comment" class="textarea"></textarea>
                <div style="display: flex; margin-top: 32px; align-items: center;">
                    <div style="flex-grow: 1;"></div>
                    @if (closureType == 'close') {
                        <button class="close-button" (click)="closeIssue()">
                            <svg style="fill: #ab7df8; margin-right: 6px;">
                                <path d="M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"></path>
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"></path>
                            </svg>
                            <span>Close issue</span>
                        </button>
                    } @else if (closureType == 'reopen') {
                        <button class="close-button" (click)="closeIssue()">
                            <svg style="fill: #3fb950; margin-right: 6px;">
                                <path d="M5.029 2.217a6.5 6.5 0 0 1 9.437 5.11.75.75 0 1 0 1.492-.154 8 8 0 0 0-14.315-4.03L.427 1.927A.25.25 0 0 0 0 2.104V5.75A.25.25 0 0 0 .25 6h3.646a.25.25 0 0 0 .177-.427L2.715 4.215a6.491 6.491 0 0 1 2.314-1.998ZM1.262 8.169a.75.75 0 0 0-1.22.658 8.001 8.001 0 0 0 14.315 4.03l1.216 1.216a.25.25 0 0 0 .427-.177V10.25a.25.25 0 0 0-.25-.25h-3.646a.25.25 0 0 0-.177.427l1.358 1.358a6.501 6.501 0 0 1-11.751-3.11.75.75 0 0 0-.272-.506Z"></path>
                                <path d="M9.06 9.06a1.5 1.5 0 1 1-2.12-2.12 1.5 1.5 0 0 1 2.12 2.12Z"></path>
                            </svg>
                            <span>Reopen issue</span>
                        </button>
                    } @else if (closureType == 'wontfix') {
                        <button class="close-button" (click)="closeIssue()">
                            <svg style="margin-right: 6px;">
                                <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm9.78-2.22-5.5 5.5a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l5.5-5.5a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"></path>
                            </svg>
                            <span>Close issue</span>
                        </button>
                    }
                    <button class="more-close-buttons" style="margin-right: 8px;" (click)="closureDropdownShow = !closureDropdownShow">
                        <svg>
                            <path d="m4.427 7.427 3.396 3.396a.25.25 0 0 0 .354 0l3.396-3.396A.25.25 0 0 0 11.396 7H4.604a.25.25 0 0 0-.177.427Z"></path>
                        </svg>
                    </button>

                    <div style="position: relative; top: -180px;" *ngIf="closureDropdownShow">
                        <div class="close-button-dropdown">
                            <button class="closure-dropdown trans" (click)="closureType = 'reopen'; closureDropdownShow = false" style="max-height: 32px;" *ngIf="!this.isOpen()">
                                <svg>
                                    @if (closureType == "reopen") {
                                        <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                    }
                                </svg>
                                <svg style="color: #3fb950;">
                                    <path d="M5.029 2.217a6.5 6.5 0 0 1 9.437 5.11.75.75 0 1 0 1.492-.154 8 8 0 0 0-14.315-4.03L.427 1.927A.25.25 0 0 0 0 2.104V5.75A.25.25 0 0 0 .25 6h3.646a.25.25 0 0 0 .177-.427L2.715 4.215a6.491 6.491 0 0 1 2.314-1.998ZM1.262 8.169a.75.75 0 0 0-1.22.658 8.001 8.001 0 0 0 14.315 4.03l1.216 1.216a.25.25 0 0 0 .427-.177V10.25a.25.25 0 0 0-.25-.25h-3.646a.25.25 0 0 0-.177.427l1.358 1.358a6.501 6.501 0 0 1-11.751-3.11.75.75 0 0 0-.272-.506Z"></path>
                                    <path d="M9.06 9.06a1.5 1.5 0 1 1-2.12-2.12 1.5 1.5 0 0 1 2.12 2.12Z"></path>
                                </svg>
                                <span class="closure-dropdown-title">Reopen issue</span>
                            </button>
                            <div class="closure-dropdown-separator" *ngIf="!this.isOpen()"></div>
                            <button class="closure-dropdown trans" (click)="closureType = 'close'; closureDropdownShow = false" *ngIf="!this.isClosed()">
                                <svg>
                                    @if (closureType == "close") {
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                    }
                                </svg>
                                <svg style="color: #ab7df8;">
                                    <path d="M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"></path>
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"></path>
                                </svg>
                                <div>
                                    <span class="closure-dropdown-title">Close as completed</span>
                                    <span class="closure-dropdown-desc">Done, closed, fixed, resolved</span>
                                </div>
                            </button>
                            <div class="closure-dropdown-separator" *ngIf="!this.isClosed()"></div>
                            <button class="closure-dropdown trans" (click)="closureType = 'wontfix'; closureDropdownShow = false" *ngIf="!this.isNotPlanned()">
                                <svg>
                                    @if (closureType == "wontfix") {
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                    }
                                </svg>
                                <svg>
                                    <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm9.78-2.22-5.5 5.5a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l5.5-5.5a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"></path>
                                </svg>
                                <div>
                                    <span class="closure-dropdown-title">Close as not planned</span>
                                    <span class="closure-dropdown-desc">Won't fix, can't repo, stale</span>
                                </div>
                            </button>
                        </div>
                    </div>


                    <button class="post-button" (click)="postComment()"><span>Comment</span></button>
                </div>
            </div>
        } @else {
            <div class="logout-message">
                <span>Sign up to join this conversation on GitGut. Already have an account? Sign in to comment</span>
            </div>
        }
    </div>

    <issue-right-block-settings [issue]="issue!" [accountLogger$]="this.accountLogger$">

    </issue-right-block-settings>

    


</div>
<div style="height: 100px; min-height: 100px;"></div>