<gigut-header [issueCount$]="issueTrackerService.issueCount$"></gigut-header>

<div style="display: flex;">
    
    <div class="host">
        <div class="outer-header">
            <div class="search-field-total">
                <input class="search-field-input" [(ngModel)]="searchDraft"/>
                <svg class="clear-search-field" *ngIf="this.searchDraft.trim()" (click)="searchDraft = ''; search()">
                    <path d="M2.343 13.657A8 8 0 1 1 13.658 2.343 8 8 0 0 1 2.343 13.657ZM6.03 4.97a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042L6.94 8 4.97 9.97a.749.749 0 0 0 .326 1.275.749.749 0 0 0 .734-.215L8 9.06l1.97 1.97a.749.749 0 0 0 1.275-.326.749.749 0 0 0-.215-.734L9.06 8l1.97-1.97a.749.749 0 0 0-.326-1.275.749.749 0 0 0-.734.215L8 6.94Z"></path>
                </svg>
                <button class="search-button" (click)="search()">
                    <svg>
                        <path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7Z"></path>
                    </svg>
                </button>
            </div>

            <button class="new-issue-button" (click)="showCreationDialog = true">
                <span>New label</span>
            </button>
        </div>

        <div class="main-panel">
            <div class="header">
                <span style="padding: 8px; font-weight: 600;">{{this.labelService.list.length}} labels</span>

                <div class="space"></div>

                <button class="more trans" (click)="showMoreDialog = !showMoreDialog">
                    @if (sortOrder == 'descending') {
                        <svg>
                            <path d="M0 4.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Zm0 4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0 4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75ZM13.5 10h2.25a.25.25 0 0 1 .177.427l-3 3a.25.25 0 0 1-.354 0l-3-3A.25.25 0 0 1 9.75 10H12V3.75a.75.75 0 0 1 1.5 0V10Z"></path>
                        </svg>
                    } @else {
                        <svg>
                            <path d="m12.927 2.573 3 3A.25.25 0 0 1 15.75 6H13.5v6.75a.75.75 0 0 1-1.5 0V6H9.75a.25.25 0 0 1-.177-.427l3-3a.25.25 0 0 1 .354 0ZM0 12.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75Zm0-4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0-4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Z"></path>
                        </svg>
                    }
                    <span>Sort</span>
                    <svg>
                        <path d="m4.427 7.427 3.396 3.396a.25.25 0 0 0 .354 0l3.396-3.396A.25.25 0 0 0 11.396 7H4.604a.25.25 0 0 0-.177.427Z"></path>
                    </svg>
                </button>
                <div style="position: relative; left: -200px;" *ngIf="showMoreDialog">
                    <div class="dialog" style="width: 200px; padding-bottom: 6px;">
                        <span class="assignee-dropdown-title">Sort by</span>
                        
                        <button class="trans dialog-button"  (click)="sortBy = 'name'; load()">
                            <svg>
                                @if (sortBy == 'name') {
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                }
                            </svg>
                            <span class="assignee-name">Name</span>
                        </button>
                        <button class="trans dialog-button"  (click)="sortBy = 'issues'; load()">
                            <svg>
                                @if (sortBy == 'issues') {
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                }
                            </svg>
                            <span class="assignee-name">Total issue count</span>
                        </button>

                        <div class="separator" style="margin-top: 4px; margin-bottom: 4px;"></div>

                        <span class="assignee-dropdown-title">Order</span>

                        <button class="trans dialog-button"  (click)="sortOrder = 'ascending'; load()">
                            <svg>
                                @if (sortOrder == 'ascending') {
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                }
                            </svg>
                            <svg style="width: 20px; height: 20px;"><path d="m12.927 2.573 3 3A.25.25 0 0 1 15.75 6H13.5v6.75a.75.75 0 0 1-1.5 0V6H9.75a.25.25 0 0 1-.177-.427l3-3a.25.25 0 0 1 .354 0ZM0 12.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75Zm0-4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0-4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Z"></path></svg>
                            <span class="assignee-name">Ascending</span>
                        </button>
                        <button class="trans dialog-button"  (click)="sortOrder = 'descending'; load()">
                            <svg>
                                @if (sortOrder == 'descending') {
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                                }
                            </svg>
                            <svg style="width: 20px; height: 20px;"><path d="M0 4.25a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 4.25Zm0 4a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8.25Zm0 4a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H.75a.75.75 0 0 1-.75-.75ZM13.5 10h2.25a.25.25 0 0 1 .177.427l-3 3a.25.25 0 0 1-.354 0l-3-3A.25.25 0 0 1 9.75 10H12V3.75a.75.75 0 0 1 1.5 0V10Z"></path></svg>
                            <span class="assignee-name">Descending</span>
                        </button>

                    </div>
                </div>
            </div>
            <label-item *ngFor="let item of filteredList" [labelService]="labelService" [item]="item" (edit)="editLabel(item)" (delete)="labelToEdit=item; deletingLabel=true"/>
            <div class="list" *ngIf="filteredList.length == 0">
                <div class="no-results">
                    <h3 class="no-results">No results</h3>
                    <p class="no-results">Try adding new labels.</p>
                </div>
            </div>
        </div>
    </div>


    <div class="creation-dialog-parent" *ngIf="showCreationDialog">
        <div class="creation-dialog dialog">
            <div class="dialog-header">
                @if (labelToEdit) {
                    <span class="dialog-title">Edit label</span>
                } @else {
                    <span class="dialog-title">New label</span>
                }
                <button class="trans" style="width: 32px; padding: 0px;" (click)="discardCreatingOrEditing()">
                    <svg>
                        <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
                    </svg>
                </button>
            </div>
            <div class="separator" style="width: 100%;"></div>

            <div class="dialog-content">

                <div class="preview-space">
                    <label [color]="newLabel.color" [name]="newLabel.name.trim() ? newLabel.name.trim() : 'Preview label'"></label>
                </div>
                
                <div>
                    <span class="dialog-subtitle">Name</span>
                    <input class="dialog-input" placeholder="Label name" [(ngModel)]="newLabel.name" (input)="triedToSaveWithoutName=false">
                    <div style="display: flex;" *ngIf="triedToSaveWithoutName">
                        <svg style="color: #f85149;">
                            <path d="M4.855.708c.5-.896 1.79-.896 2.29 0l4.675 8.351a1.312 1.312 0 0 1-1.146 1.954H1.33A1.313 1.313 0 0 1 .183 9.058ZM7 7V3H5v4Zm-1 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"></path>
                        </svg>
                        <span style="color: #f85149;">Name is required</span>
                    </div>
                </div>

                <div>
                    <span class="dialog-subtitle">Description</span>
                    <textarea class="dialog-textarea" placeholder="Optionally add a description" [(ngModel)]="newLabel.description"></textarea>
                </div>

                <div>
                    <span class="dialog-subtitle">Color</span>
                    <div style="display: flex; gap: 8px; margin-top: .25rem;">
                        <div class="label dialog-color-preview" [style.--r]="newLabel.color.r" [style.--g]="newLabel.color.g" [style.--b]="newLabel.color.b" [style.--h]="newLabel.color.h" [style.--s]="newLabel.color.s" [style.--l]="newLabel.color.l" (click)="setRandomColor()">
                            <svg style="color: inherit">
                                <path d="M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z"></path>
                            </svg>
                        </div>
                        <input class="dialog-color-input" [(ngModel)]="newLabelColorHex" (input)="setColor()" [style.border-color]="isColorHexValid? '#238636' : '#da3633'">
                    </div>
                </div>
                
            </div>

            <div style="display: flex; gap: 8px; padding: 1rem; width: 100%; box-sizing: border-box;">
                <div class="space"></div>
                <button (click)="discardCreatingOrEditing()">
                    <span>Close</span>
                </button>
                @if (labelToEdit) {
                    <button class="new-issue-button" (click)="saveEditChanges()">
                        <span>Save changes</span>
                    </button>
                } @else {
                    <button class="new-issue-button" (click)="createNewLabel()">
                        <span>Create label</span>
                    </button>
                }
            </div>
        </div>
    </div>
    <div class="dialog deletion-dialog-parent" *ngIf="deletingLabel">
        <div class="dialog deletion-dialog">
            <div class="dialog-header">
                <span class="dialog-title" style="font-size: 1rem; margin-bottom: 10px;">Permanently delete label</span>
                <button class="trans" style="width: 32px; padding: 0px;" (click)="discardCreatingOrEditing()">
                    <svg>
                        <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
                    </svg>
                </button>
            </div>
            <div class="dialog-content" style="padding-top: 0px; gap: 0px;">
                 <p>Once you delete this label, you will not be able to see it again.</p>
                <p>Deleting this label will remove it from all issues and pull requests.</p>
            </div>
            <div style="display: flex; gap: 8px; padding: 16px; padding-top: 4px; width: 100%; box-sizing: border-box;">
                <div class="space"></div>
                <button (click)="discardCreatingOrEditing()">
                    <span>Close</span>
                </button>
                <button class="deletion-button" (click)="deleteLabel()">
                    <span style="color: var(--ok, #fa5e55);">Delete this label</span>
                </button>
            </div>
        </div>
    </div>
</div>